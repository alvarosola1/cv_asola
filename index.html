<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CV Interactivo - Álvaro Sola Martínez</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Brilliant Blues -->
    <!-- Application Structure Plan: The SPA is designed as an interactive dashboard. The main sections are a header, a skills overview, and a two-column layout for the core interactive experience. The left column contains technology filters (buttons) that control the content on the right. The right column features a dynamic details panel and a career timeline. This structure was chosen to allow non-linear exploration of the user's career. A recruiter can either follow the timeline chronologically or filter by a specific technology to see all roles where that skill was applied, making it highly user-centric and efficient for information discovery. -->
    <!-- Visualization & Content Choices: 
        - Profile Summary (Inform): Simple text in a styled card.
        - Key Skills (Compare/Organize): A Radar Chart (Chart.js/Canvas) is used to provide a multi-dimensional view of proficiency across key domains (e.g., Cloud, IaC, Observability). This is more engaging than a simple list.
        - Technology Filters (Organize/Interact): HTML buttons with JS event listeners provide the core interaction mechanism.
        - Career Timeline (Change/Organize): A vertical timeline built with structured HTML/CSS provides a clear chronological path. It's interactive, with each item being clickable.
        - Job Details (Inform): A dynamic HTML panel updated with JS shows detailed responsibilities and technologies for the selected job or technology filter, providing context.
        - Gemini API Features (Interact/Synthesize): Buttons to generate summaries of experience with a specific technology and to suggest interview questions for a role. This adds a layer of intelligent analysis.
        - PDF Generation (Export): On-the-fly PDF generation using jsPDF now builds a professional, text-based CV document from the data, ignoring the web layout for a clean, traditional format.
        - CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }
        .chart-container {
            position: relative;
            height: 350px;
            width: 100%;
            max-width: 500px;
            margin: auto;
        }
        .tech-button {
            transition: all 0.2s ease-in-out;
        }
        .tech-button.active {
            background-color: #0077B6 !important;
            color: white !important;
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0, 119, 182, 0.3);
        }
        .timeline-item {
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .timeline-item.active {
            background-color: #CAF0F8;
            border-left-color: #0077B6;
        }
        .gemini-modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.5);
        }
        .gemini-modal-content {
            background-color: #fefefe;
            margin: 10% auto;
            padding: 2rem;
            border: 1px solid #888;
            width: 90%;
            max-width: 600px;
            border-radius: 1rem;
            position: relative;
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #0077B6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 2rem auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="text-gray-800">

    <main class="container mx-auto p-4 sm:p-6 md:p-8">
        <header class="text-center mb-10">
            <h1 class="text-4xl md:text-5xl font-bold text-[#004E89]">Álvaro Sola Martínez</h1>
            <p class="text-xl text-[#0077B6] mt-2">Ingeniero DevOps & Arquitecto de Sistemas</p>
            <div class="mt-6">
                <button id="download-pdf-btn" class="inline-block bg-[#0077B6] text-white font-bold py-3 px-6 rounded-lg shadow-md hover:bg-[#004E89] transition-colors text-lg">
                    Descargar CV (PDF) 📄
                </button>
            </div>
        </header>

        <section id="skills-overview" class="mb-12">
            <div class="bg-white p-6 rounded-xl shadow-lg">
                 <h2 class="text-2xl font-bold text-center text-[#004E89] mb-4">Áreas de Competencia</h2>
                 <p class="text-center text-gray-600 mb-6 max-w-3xl mx-auto">Este gráfico resume las áreas de especialización principales. Cada eje representa un dominio tecnológico clave, mostrando una visión integral y equilibrada del perfil técnico.</p>
                <div class="chart-container">
                    <canvas id="skillsRadarChart"></canvas>
                </div>
            </div>
        </section>

        <section id="interactive-experience">
             <h2 class="text-2xl font-bold text-center text-[#004E89] mb-4">Explora la Experiencia</h2>
             <p class="text-center text-gray-600 mb-8 max-w-3xl mx-auto">Haz clic en una tecnología para filtrar la trayectoria profesional o selecciona un puesto en la línea de tiempo para ver los detalles.</p>

            <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
                
                <aside class="lg:col-span-3">
                    <div class="bg-white p-6 rounded-xl shadow-lg sticky top-8">
                        <h3 class="text-xl font-bold text-[#004E89] mb-4">Filtrar por Tecnología</h3>
                        <div id="tech-filters" class="flex flex-wrap gap-2">
                        </div>
                    </div>
                </aside>

                <div class="lg:col-span-9">
                    <div class="grid grid-cols-1 md:grid-cols-5 gap-8">
                        
                        <div id="details-panel" class="md:col-span-3 bg-white p-6 rounded-xl shadow-lg min-h-[300px]">
                            <h3 id="details-title" class="text-2xl font-bold text-[#004E89] mb-2"></h3>
                            <p id="details-subtitle" class="text-md text-[#0077B6] font-semibold mb-4"></p>
                            <div id="details-content" class="space-y-2 text-gray-700"></div>
                            <div id="gemini-buttons" class="mt-6 pt-4 border-t"></div>
                        </div>

                        <div id="timeline-panel" class="md:col-span-2">
                             <div id="timeline" class="space-y-4"></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="text-center mt-12 py-6 border-t border-gray-200">
        <p class="text-lg text-[#0077B6]">Contacto</p>
        <p class="text-[#004E89] font-semibold">alvaro.sola.martinez@gmail.com | 649 807 281</p>
    </footer>

    <div id="gemini-modal" class="gemini-modal">
        <div class="gemini-modal-content">
            <span id="close-modal" class="absolute top-4 right-6 text-3xl text-gray-500 hover:text-gray-800 cursor-pointer">&times;</span>
            <h3 id="modal-title" class="text-2xl font-bold text-[#004E89] mb-4"></h3>
            <div id="modal-body"></div>
        </div>
    </div>

    <script>
        const cvData = {
            profile: 'Ingeniero DevOps y Arquitecto de Sistemas con más de 15 años de experiencia en la administración, automatización y optimización de infraestructuras TI complejas. Especializado en el diseño de soluciones de plataforma, observabilidad y automatización de procesos. Cuento con un sólido historial en la implementación y gestión de tecnologías de vanguardia como Kubernetes, Elastic Stack y soluciones Cloud en entornos de alta disponibilidad.',
            certifications: [
                'Elastic Certified Engineer (2023)',
                'Red Hat Certified Engineer (RHCE) (2022)',
                'Red Hat Certified System Administrator (RHCSA) (2021)',
                'Certified Kubernetes Administrator (CKA) (2021)',
                'Microsoft Certified: Azure Administrator Associate (2021)',
                'Microsoft Certified: Azure Fundamentals (2020)',
                'Red Hat Certified Specialist in Ansible Automation (2019)',
                'ITIL Foundation Certificate in IT Service Management (2013)'
            ],
            jobs: [
                {
                    id: 1,
                    role: 'Demand Manager & Cloud Architect',
                    company: 'Knowmad Mood (para El Corte Inglés)',
                    period: 'Mar 2024 - Actualidad',
                    technologies: ['Azure', 'Terraform', 'Ansible', 'Grafana', 'Elastic Stack', 'GitHub Actions', 'CI/CD'],
                    description: [
                        'Diseño de soluciones de arquitectura cloud y on-premise para el equipo de plataforma.',
                        'Liderazgo en la implementación de automatizaciones con GitHub Actions, Terraform y Ansible (CI/CD).',
                        'Gestión de la observabilidad de plataformas con Grafana y Elastic Stack.',
                        'Administración y optimización de recursos en Microsoft Azure.'
                    ]
                },
                {
                    id: 2,
                    role: 'Especialista DevOps Observabilidad',
                    company: 'Datadope',
                    period: '2022 - Mar 2024',
                    technologies: ['Elastic Stack', 'Python', 'Kubernetes', 'Docker', 'Grafana', 'Prometheus', 'Git', 'Machine Learning'],
                    description: [
                        'Lideré la estrategia de observabilidad con Elastic Stack (Elasticsearch, Beats, Kibana).',
                        'Apliqué técnicas de Machine Learning para la creación de paneles de detección de anomalías.',
                        'Desarrollé scripts de automatización en Python y Bash.',
                        'Administré entornos de contenedores con Kubernetes y Docker.'
                    ]
                },
                {
                    id: 3,
                    role: 'Ingeniero DevOps',
                    company: 'Inetum (para Viajes El Corte Inglés)',
                    period: '2019 - 2022',
                    technologies: ['Kubernetes', 'Ansible', 'Python', 'Azure', 'GlusterFS', 'CephFS', 'F5', 'HAProxy', 'Docker'],
                    description: [
                        'Instalé y administré clústeres de Kubernetes para aplicaciones críticas.',
                        'Automaticé infraestructura desarrollando módulos personalizados en Ansible con Python.',
                        'Gestioné infraestructuras cloud en Azure y vCloud.',
                        'Administré almacenamiento distribuido con GlusterFS y CephFS.'
                    ]
                },
                {
                    id: 4,
                    role: 'Analista de Sistemas',
                    company: 'Mr Informática (para IMSERSO)',
                    period: '2016 - 2019',
                    technologies: ['Red Hat', 'Linux', 'Ansible', 'Puppet', 'OpenStack', 'Docker', 'Kubernetes', 'VMware'],
                    description: [
                        'Dirigí la planificación y ejecución de nuevos proyectos TI.',
                        'Administré sistemas Red Hat y CentOS.',
                        'Implementé automatización con Ansible y gestión de configuración con Puppet.',
                        'Introduje la contenedorización de aplicaciones con OpenShift (Docker, Kubernetes).'
                    ]
                },
                {
                    id: 5,
                    role: 'Administrador de Sistemas Linux',
                    company: 'IBM (para Gas Natural Fenosa)',
                    period: '2012 - 2016',
                    technologies: ['Linux', 'Red Hat', 'AIX', 'HP-UX', 'VMware', 'Shell Scripting', 'LVM', 'NFS', 'SAN'],
                    description: [
                        'Actué como Administrador de Sistemas Nivel 3 para Red Hat en entornos de alta disponibilidad.',
                        'Gestioné virtualización con VMware ESX, vSphere, y VIOServer.',
                        'Planifiqué y ejecuté migraciones y actualizaciones con Red Hat Satellite.',
                        'Desarrollé scripts en Shell para la automátización de tareas.'
                    ]
                }
            ]
        };

        let activeFilter = null;
        let activeJobId = 1;

        const techFiltersContainer = document.getElementById('tech-filters');
        const timelineContainer = document.getElementById('timeline');
        const detailsTitle = document.getElementById('details-title');
        const detailsSubtitle = document.getElementById('details-subtitle');
        const detailsContent = document.getElementById('details-content');
        const geminiButtonsContainer = document.getElementById('gemini-buttons');
        const modal = document.getElementById('gemini-modal');
        const modalTitle = document.getElementById('modal-title');
        const modalBody = document.getElementById('modal-body');
        const downloadPdfBtn = document.getElementById('download-pdf-btn');
        const closeModalBtn = document.getElementById('close-modal');

        async function callGeminiApi(prompt, retries = 3, delay = 1000) {
            const apiKey = "";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
            
            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                });

                if (!response.ok) {
                    if (response.status === 429 && retries > 0) {
                        await new Promise(res => setTimeout(res, delay));
                        return callGeminiApi(prompt, retries - 1, delay * 2);
                    }
                    throw new Error(`Error de API: ${response.status}`);
                }

                const result = await response.json();
                return result.candidates[0].content.parts[0].text;
            } catch (error) {
                console.error("Error en la llamada a Gemini:", error);
                return "Hubo un error al contactar con la IA. Por favor, inténtalo de nuevo más tarde.";
            }
        }
        
        function formatApiResponse(text) {
            return text
                .replace(/\*\*(.*?)\*\*/g, '<strong class="text-[#004E89]">$1</strong>')
                .replace(/\*/g, '<br><br>• ')
                .replace(/\n/g, '<br>');
        }

        function showModal(title, isLoading = true) {
            modalTitle.textContent = title;
            modalBody.innerHTML = isLoading ? '<div class="loader"></div>' : '';
            modal.style.display = 'block';
        }

        function updateModalContent(content) {
            modalBody.innerHTML = `<div class="text-gray-700 space-y-4">${formatApiResponse(content)}</div>`;
        }
        
        closeModalBtn.onclick = () => modal.style.display = "none";
        window.onclick = (event) => {
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }
        
        async function generatePdf() {
            const downloadButton = document.getElementById('download-pdf-btn');
            downloadButton.disabled = true;
            downloadButton.innerHTML = 'Generando PDF... ⏳';

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            const MARGIN = 15;
            const PAGE_WIDTH = doc.internal.pageSize.getWidth();
            const FONT_SIZE_NORMAL = 10;
            const FONT_SIZE_H1 = 18;
            const FONT_SIZE_H2 = 14;
            const LINE_HEIGHT = 6;
            let y = MARGIN;

            function checkPageBreak(neededHeight) {
                if (y + neededHeight > doc.internal.pageSize.getHeight() - MARGIN) {
                    doc.addPage();
                    y = MARGIN;
                }
            }

            try {
                // Header
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(FONT_SIZE_H1);
                doc.setTextColor('#004E89');
                doc.text('Álvaro Sola Martínez', PAGE_WIDTH / 2, y, { align: 'center' });
                y += LINE_HEIGHT * 1.5;

                doc.setFont('helvetica', 'normal');
                doc.setFontSize(FONT_SIZE_NORMAL);
                doc.setTextColor('#0077B6');
                const contactInfo = 'Madrid (28029) | 649 807 281 | alvaro.sola.martinez@gmail.com';
                doc.text(contactInfo, PAGE_WIDTH / 2, y, { align: 'center' });
                y += LINE_HEIGHT * 2;

                // Profile Section
                doc.setFontSize(FONT_SIZE_H2);
                doc.setTextColor('#004E89');
                doc.text('Perfil Profesional', MARGIN, y);
                y += LINE_HEIGHT;
                doc.setDrawColor('#90E0EF');
                doc.line(MARGIN, y, PAGE_WIDTH - MARGIN, y);
                y += LINE_HEIGHT;

                doc.setFontSize(FONT_SIZE_NORMAL);
                doc.setTextColor('#333333');
                const profileText = doc.splitTextToSize(cvData.profile, PAGE_WIDTH - MARGIN * 2);
                doc.text(profileText, MARGIN, y);
                y += profileText.length * LINE_HEIGHT;
                
                // Experience Section
                y += LINE_HEIGHT;
                checkPageBreak(LINE_HEIGHT * 2);
                doc.setFontSize(FONT_SIZE_H2);
                doc.setTextColor('#004E89');
                doc.text('Experiencia Profesional', MARGIN, y);
                y += LINE_HEIGHT;
                doc.setDrawColor('#90E0EF');
                doc.line(MARGIN, y, PAGE_WIDTH - MARGIN, y);
                y += LINE_HEIGHT;

                cvData.jobs.forEach(job => {
                    checkPageBreak(LINE_HEIGHT * 8); // Estimate space needed for a job entry
                    doc.setFont('helvetica', 'bold');
                    doc.setFontSize(FONT_SIZE_NORMAL);
                    doc.setTextColor('#004E89');
                    doc.text(`${job.role}`, MARGIN, y);
                    
                    doc.setFont('helvetica', 'normal');
                    doc.setTextColor('#0077B6');
                    doc.text(`${job.company}`, MARGIN + 60, y);

                    doc.setFont('helvetica', 'italic');
                    doc.setTextColor('#555555');
                    doc.text(job.period, PAGE_WIDTH - MARGIN, y, { align: 'right' });
                    y += LINE_HEIGHT;

                    doc.setFont('helvetica', 'normal');
                    doc.setTextColor('#333333');
                    job.description.forEach(desc => {
                        checkPageBreak(LINE_HEIGHT * 2);
                        const descText = doc.splitTextToSize(`• ${desc}`, PAGE_WIDTH - MARGIN * 2 - 5);
                        doc.text(descText, MARGIN + 5, y);
                        y += descText.length * (LINE_HEIGHT * 0.8);
                    });
                    y += LINE_HEIGHT * 0.5;
                });

                // Certifications Section
                y += LINE_HEIGHT;
                checkPageBreak(LINE_HEIGHT * (cvData.certifications.length + 2));
                doc.setFontSize(FONT_SIZE_H2);
                doc.setTextColor('#004E89');
                doc.text('Certificaciones', MARGIN, y);
                y += LINE_HEIGHT;
                doc.setDrawColor('#90E0EF');
                doc.line(MARGIN, y, PAGE_WIDTH - MARGIN, y);
                y += LINE_HEIGHT;

                doc.setFontSize(FONT_SIZE_NORMAL);
                doc.setTextColor('#333333');
                cvData.certifications.forEach(cert => {
                    checkPageBreak(LINE_HEIGHT);
                    doc.text(`• ${cert}`, MARGIN, y);
                    y += LINE_HEIGHT * 0.9;
                });

                doc.save('CV_Alvaro_Sola_Martinez.pdf');

            } catch (error) {
                console.error("Error al generar el PDF:", error);
                alert("Hubo un error al generar el PDF. Por favor, inténtalo de nuevo.");
            } finally {
                downloadButton.disabled = false;
                downloadButton.innerHTML = 'Descargar CV (PDF) 📄';
            }
        }

        function renderGeminiButtons(type, context) {
            geminiButtonsContainer.innerHTML = '';
            if (type === 'job') {
                const button = document.createElement('button');
                button.innerHTML = `✨ Sugerir Preguntas de Entrevista`;
                button.className = 'bg-[#004E89] text-white font-bold py-2 px-4 rounded-lg w-full hover:bg-[#0077B6] transition-colors';
                button.onclick = () => handleInterviewQuestions(context);
                geminiButtonsContainer.appendChild(button);
            } else if (type === 'tech') {
                const button = document.createElement('button');
                button.innerHTML = `✨ Generar Resumen con IA`;
                button.className = 'bg-[#004E89] text-white font-bold py-2 px-4 rounded-lg w-full hover:bg-[#0077B6] transition-colors';
                button.onclick = () => handleTechSummary(context);
                geminiButtonsContainer.appendChild(button);
            }
        }

        async function handleInterviewQuestions(jobId) {
            const job = cvData.jobs.find(j => j.id === jobId);
            if (!job) return;
            showModal(`Preguntas para: ${job.role}`);
            const prompt = `Para el puesto de "${job.role}" con responsabilidades como "${job.description.join(', ')}" y usando tecnologías como "${job.technologies.join(', ')}", genera 5 preguntas de entrevista técnicas y 3 conductuales relevantes.`;
            const response = await callGeminiApi(prompt);
            updateModalContent(response);
        }

        async function handleTechSummary(tech) {
            const jobsWithTech = cvData.jobs.filter(j => j.technologies.includes(tech));
            if (jobsWithTech.length === 0) return;
            showModal(`Resumen de experiencia con: ${tech}`);
            const experienceText = jobsWithTech.map(j => `En el rol de ${j.role} en ${j.company}, las responsabilidades incluían: ${j.description.join('. ')}`).join('\n');
            const prompt = `Basado en la siguiente experiencia profesional con "${tech}", redacta un resumen conciso y profesional de las habilidades y logros de Álvaro Sola Martínez:\n${experienceText}`;
            const response = await callGeminiApi(prompt);
            updateModalContent(response);
        }

        function renderTechFilters() {
            const uniqueTechs = [...new Set(cvData.jobs.flatMap(j => j.technologies))].sort();
            techFiltersContainer.innerHTML = uniqueTechs.map(tech => `
                <button class="tech-button text-sm bg-gray-200 text-gray-700 font-semibold py-1 px-3 rounded-full" data-tech="${tech}">
                    ${tech}
                </button>
            `).join('');
        }

        function renderTimeline(filteredJobs = cvData.jobs) {
            timelineContainer.innerHTML = filteredJobs.map(job => `
                <div class="timeline-item border-l-4 border-gray-200 p-4 rounded-r-lg bg-white shadow-sm hover:bg-gray-100 ${job.id === activeJobId ? 'active' : ''}" data-job-id="${job.id}">
                    <p class="font-bold text-[#004E89]">${job.role}</p>
                    <p class="text-sm text-gray-600">${job.company}</p>
                    <p class="text-xs text-gray-500 mt-1">${job.period}</p>
                </div>
            `).join('');
        }

        function renderDetails(jobId) {
            const job = cvData.jobs.find(j => j.id === jobId);
            if (!job) return;
            activeJobId = jobId;
            detailsTitle.textContent = job.role;
            detailsSubtitle.textContent = `${job.company} | ${job.period}`;
            detailsContent.innerHTML = `
                <p class="font-semibold mb-3">Responsabilidades y Logros:</p>
                <ul class="list-disc list-inside space-y-2 mb-4">
                    ${job.description.map(d => `<li>${d}</li>`).join('')}
                </ul>
                <p class="font-semibold mb-2">Tecnologías Clave:</p>
                <div class="flex flex-wrap gap-2">
                    ${job.technologies.map(t => `<span class="bg-[#90E0EF] text-[#004E89] text-xs font-bold px-2 py-1 rounded-full">${t}</span>`).join('')}
                </div>
            `;
            document.querySelectorAll('.timeline-item').forEach(item => {
                item.classList.toggle('active', parseInt(item.dataset.jobId) === jobId);
            });
            renderGeminiButtons('job', jobId);
        }
        
        function renderTechDetails(tech) {
            const jobsWithTech = cvData.jobs.filter(j => j.technologies.includes(tech));
            detailsTitle.textContent = `Experiencia con ${tech}`;
            detailsSubtitle.textContent = `Roles donde se utilizó esta tecnología.`;
            detailsContent.innerHTML = `
                <p class="font-semibold mb-3">Proyectos y responsabilidades destacados:</p>
                <ul class="list-disc list-inside space-y-3">
                    ${jobsWithTech.map(job => `
                        <li>
                            <span class="font-bold">${job.role}</span> en ${job.company} (${job.period}).
                        </li>
                    `).join('')}
                </ul>
                <p class="mt-4 text-sm text-gray-500">Selecciona un puesto en la línea de tiempo para ver más detalles.</p>
            `;
            renderGeminiButtons('tech', tech);
        }

        function handleFilterClick(e) {
            const button = e.target.closest('.tech-button');
            if (!button) return;
            const tech = button.dataset.tech;
            document.querySelectorAll('.tech-button').forEach(btn => btn.classList.remove('active'));
            if (activeFilter === tech) {
                activeFilter = null;
                renderTimeline();
                renderDetails(activeJobId || 1);
            } else {
                activeFilter = tech;
                button.classList.add('active');
                const filteredJobs = cvData.jobs.filter(job => job.technologies.includes(tech));
                renderTimeline(filteredJobs);
                renderTechDetails(tech);
            }
        }

        function handleTimelineClick(e) {
            const item = e.target.closest('.timeline-item');
            if (!item) return;
            const jobId = parseInt(item.dataset.jobId);
            activeJobId = jobId;
            if (activeFilter) {
                activeFilter = null;
                document.querySelectorAll('.tech-button').forEach(btn => btn.classList.remove('active'));
                renderTimeline();
            }
            renderDetails(jobId);
        }

        function init() {
            renderTechFilters();
            renderTimeline();
            renderDetails(1);
            techFiltersContainer.addEventListener('click', handleFilterClick);
            timelineContainer.addEventListener('click', handleTimelineClick);
            downloadPdfBtn.addEventListener('click', generatePdf);
        }
        
        const tooltipTitleCallback = (tooltipItems) => {
            const item = tooltipItems[0];
            let label = item.chart.data.labels[item.dataIndex];
            if (Array.isArray(label)) { return label.join(' '); }
            return label;
        };
        
        const commonTooltipOptions = {
            plugins: { tooltip: { callbacks: { title: tooltipTitleCallback } } }
        };

        const skillsRadarCtx = document.getElementById('skillsRadarChart').getContext('2d');
        new Chart(skillsRadarCtx, {
            type: 'radar',
            data: {
                labels: ['Cloud (Azure)', 'Contenedores (K8s, Docker)', 'IaC (Terraform, Ansible)', 'Observabilidad (Elastic, Grafana)', 'CI/CD & Git', 'Scripting (Python, Bash)'],
                datasets: [{
                    label: 'Nivel de Competencia',
                    data: [96, 98, 98, 97, 98, 97],
                    fill: true,
                    backgroundColor: 'rgba(72, 202, 228, 0.2)',
                    borderColor: '#48CAE4',
                    pointBackgroundColor: '#0077B6',
                    pointBorderColor: '#fff',
                    pointHoverBackgroundColor: '#fff',
                    pointHoverBorderColor: '#0077B6'
                }]
            },
            options: {
                ...commonTooltipOptions,
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    r: {
                        angleLines: { color: 'rgba(0, 0, 0, 0.1)' },
                        grid: { color: 'rgba(0, 0, 0, 0.1)' },
                        pointLabels: { font: { size: 13, weight: '600' }, color: '#004E89' },
                        ticks: { backdropColor: 'rgba(255, 255, 255, 0.75)', color: '#0077B6', min: 0, max: 100, stepSize: 20 }
                    }
                },
                plugins: { ...commonTooltipOptions.plugins, legend: { display: false } }
            }
        });

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
